@model QassimPrincipality.Application.Dtos.Content.NewsDto
@inject IViewLocalizer localizer
@{
    ViewData["Title"] = Model.Id > 0 ? localizer["Edit News"] : localizer["Add News"];
}

<h2 class="mb-4">@ViewData["Title"]</h2>

<style>
    .image-upload-box {
        background-color: #f9f9f9;
        transition: border 0.3s ease;
    }

        .image-upload-box:hover {
            border-color: #0d6efd;
        }

        .image-upload-box.dragover {
            background-color: #e9f5ff;
            border-color: #0d6efd;
        }
</style>


<form asp-action="AddEdit" method="post" enctype="multipart/form-data" class="pc-form">
    <div class="pc-form-grid-2col">

        @if (Model.Id > 0)
        {
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="ImageUrl" />
            <input type="hidden" asp-for="ImageThumbnailUrl" />
        }

        <div class="pc-input">
            <label asp-for="NameAr" class="pc-input-label">@localizer["Title (Arabic)"]</label>
            <input asp-for="NameAr" class="form-control" />
            <span asp-validation-for="NameAr" class="text-danger"></span>
        </div>

        <div class="pc-input">
            <label asp-for="NameEn" class="pc-input-label">@localizer["Title (English)"]</label>
            <input asp-for="NameEn" class="form-control" />
            <span asp-validation-for="NameEn" class="text-danger"></span>
        </div>

        <div class="pc-input">
            <label asp-for="ShortDescriptionAr" class="pc-input-label">@localizer["Description (Arabic)"]</label>
            <textarea asp-for="ShortDescriptionAr" class="form-control"></textarea>
            <span asp-validation-for="ShortDescriptionAr" class="text-danger"></span>
        </div>

        <div class="pc-input">
            <label asp-for="ShortDescriptionEn" class="pc-input-label">@localizer["Description (English)"]</label>
            <textarea asp-for="ShortDescriptionEn" class="form-control"></textarea>
            <span asp-validation-for="ShortDescriptionEn" class="text-danger"></span>
        </div>


        <div class="pc-input mb-4">
            <label class="form-label fw-bold">@localizer["News Image"]</label>

            <div class="image-upload-box border border-2 rounded p-3 text-center position-relative" style="cursor: pointer;">
                <input type="file" id="imageInput" name="file" accept="image/*" class="d-none" />
                <img id="previewImage" src="@Model.ImageUrl" alt="Preview" class="img-fluid rounded shadow-sm" style="max-height: 250px; display: @(string.IsNullOrEmpty(Model.ImageUrl) ? "none" : "block")" />
                <div id="uploadText" style="color: #6c757d; @(!string.IsNullOrEmpty(Model.ImageUrl) ? "display: none;" : "")">
                    <i class="bi bi-image fs-1 mb-2"></i><br />
                    <strong>@localizer["Click to select an image"]</strong><br />
                    <span>@localizer["or drag and drop here"]</span>
                </div>
            </div>

            <span asp-validation-for="ImageUrl" class="text-danger"></span>
        </div>

        <div class="pc-input">
            <label asp-for="PublishDateString" class="pc-input-label">@localizer["Publish Date"]</label>
            <input asp-for="PublishDateString" type="date" class="form-control" />
            <span asp-validation-for="PublishDateString" class="text-danger"></span>
        </div>


        <div class="pc-input form-check form-switch mb-4">
            <label class="form-check-label fw-bold" for="IsPublished">
                @localizer["Is Published"]
            </label>
            <input asp-for="IsPublished" style="width:20%" class="form-check-input" type="checkbox" role="switch" id="IsPublished" />
        </div>

    </div>
    <div class="d-flex justify-content-center my-5 gap-3">
        <button type="submit" class="btn btn-success px-4">@localizer["Save"]</button>
        <a asp-action="Index" class="btn btn-secondary px-4">@localizer["Cancel"]</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<script>
    const box = document.querySelector('.image-upload-box');
    const input = document.getElementById('imageInput');
    const preview = document.getElementById('previewImage');
    const uploadText = document.getElementById('uploadText');

    box.addEventListener('click', () => input.click());

    input.addEventListener('change', function () {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.src = e.target.result;
                preview.style.display = 'block';
                uploadText.style.display = 'none';
            };
            reader.readAsDataURL(this.files[0]);
        }
    });

    // دعم السحب والإفلات
    ['dragenter', 'dragover'].forEach(eventName => {
        box.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
            box.classList.add('dragover');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        box.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
            box.classList.remove('dragover');
        }, false);
    });

    box.addEventListener('drop', function (e) {
        if (e.dataTransfer.files.length > 0) {
            input.files = e.dataTransfer.files;
            const file = e.dataTransfer.files[0];
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                uploadText.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    });
</script>


