@using QassimPrincipality.Domain.Enums
@using QassimPrincipality.Web.Helpers.Business
@model QassimPrincipality.Application.Dtos.ServiceRequestDto
@{
    // Try to pull the parent’s localizer out of ViewData
    var Localizer = ViewData["ParentLocalizer"] as IViewLocalizer
                    ?? throw new InvalidOperationException("ParentLocalizer not found.");
}








<div class="section‐box" @WorkFlowHelper.hideOption(Model.Status)>

    <div class="pc-service-form-heading">
        <h4>@Localizer["AdminDecision"]</h4>
    </div>

    <form asp-action="UpdateRequestStatus" asp-route-id="@Model.Id" method="post">
        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">@Localizer["RequestStatus"]</label>

                @removeTagHelper "Microsoft.AspNetCore.Mvc.TagHelpers.OptionTagHelper, Microsoft.AspNetCore.Mvc.TagHelpers"


                <select class="form-select" required name="NewStatus" class="pc-search-select">

                    @{
                        var selected = Model.Status == null ? "selected" : "";
                        var transitions = WorkFlowHelper.GetNextTransition(Model.Status);
                    }

                    @foreach (ServiceRequestStatus status in transitions)
                    {
                        var isSelected = Model.Status == status ? "selected" : "";
                        <option value="@((int)status)" @isSelected>
                            @WorkFlowHelper.GetStatusDisplay(status, Localizer)
                        </option>
                    }

                </select>



                @*
                <select name="Status" class="form-select" required>
                <option value="">@Localizer["SelectStatus"]</option>
                <option value="@((int)ServiceRequestStatus.Approved)">@Localizer["Approved"]</option>
                <option value="@((int)ServiceRequestStatus.Rejected)">@Localizer["Rejected"]</option>
                <option value="@((int)ServiceRequestStatus.RequiresCompletion)">@Localizer["RequiresCompletion"]</option>
                <option value="@((int)ServiceRequestStatus.NotQualified)">@Localizer["NotSpecialized"]</option>
                </select> *@
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-12">
                <label class="form-label">@Localizer["Notes"]</label>
                <textarea name="Notes" class="form-control" rows="4" required></textarea>
            </div>
        </div>
        <div class="pc-form-buttons">
            <button type="submit" class="pc-primary-btn">@Localizer["Save"]</button>
        </div>
    </form>
</div>